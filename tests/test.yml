---
- hosts: test_machine
  become: yes

  roles:
    - role: install-docker
      storage_driver: overlay2
      cleanup_enabled: no
      install_pip_docker: yes

    - role: ansible-samba
      samba_port: 445
      interface: 0.0.0.0
      config_volume: /srv/docker/samba/config
      data_volume: /srv/docker/samba/data
      storage_volume: /srv/docker/samba/storage
      log_level: 2
      enable_homes: yes
      enable_netbios: yes
      netbios_name: mysamba
      unix_extensions: no
      users:
        - username: user1
          password: user1pwd
          uid: 2001
        - username: user2
          password: user2pwd
          uid: 2002
      storages:

        # this share has its own location
        - name: Share
          path: /share
          host_path: /srv/docker/samba/storage_share
          comment: Share storage
          browseable: yes
          writable: yes
          guest_access: yes

        # this share is located within storage volume
        - name: Outgoing
          path: /out
          comment: Outgoing storage
          browseable: yes
          writable: no
          guest_access: true
          write_list:
            - user1

    - role: install-avahi
      published_services:
        - name: samba
          services:
            - type: _smb._tcp
              port: 445
            - type: _device-info._tcp
              port: 0
              txt_records:
                - model=RackMac
